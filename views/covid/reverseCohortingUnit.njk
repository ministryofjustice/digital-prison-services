{% extends "../partials/layout.njk" %}
{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "./macros.njk" import notInUnitWarning %}
{% block beforeContent %}
    {{ govukBreadcrumbs({
        items: [
            {
                text: "Home",
                href: notmUrl
            },
            {
                text: "COVID units",
                href: '/current-covid-units'
            },
            {
                text: "Prisoners in the Reverse Cohorting Unit"
            }
        ]
    }) }}
{% endblock %}

  {% set rows = [] %}

    {% for result in results %}
      {% set rows = (rows.push([
        {
          html: '<a class="govuk-link govuk-link--no-visited-state" href="/prisoner/' + result.offenderNo + '">' + result.name + '</a>',
          attributes: {
            "data-sort-value": result.name
          }
        },
        {
          text: result.offenderNo
        },
        {
          text: result.assignedLivingUnitDesc
        },
        {
          text: result.alertCreated | formatDate('D MMMM YYYY'),
          attributes: {
            "data-sort-value": result.alertCreated | formatDate('X')
          }
        },
        {
          text: result.expectedMoveDate | formatDate('D MMMM YYYY'),
          attributes: {
            "data-sort-value": result.expectedMoveDate | formatDate('X')
          }
        },
        {
          html: '<a class="govuk-link govuk-link--no-visited-state" href="/prisoner/' + result.offenderNo +'/alerts">Change alert</a>'
        },
        {
          html: '<span data-qa=overdue class="govuk-body moj-badge moj-badge--red"><strong>MOVE OVERDUE</strong></span>' if result.isOverdue
        }
      ]), rows) %}
    {% endfor %}

{% block content %}
    <h1 class="govuk-heading-l">
        Prisoners in the Reverse Cohorting Unit
    </h1>

  {{ notInUnitWarning(notInUnitCount) }}

  {% if rows.length %}
    <p class="govuk-body right-content">Prisoners listed: <strong><span data-qa="prisonerCount">{{ rows.length }}</span></strong></p>

    {{ govukTable({
      head: [
        {
          text: "Name",
          attributes: {
            "aria-sort": "none",
            "data-qa": "sort-name"
          }
        },
        {
          text: "Prison number"
        },
        {
          text: "Location",
          attributes: {
            "aria-sort": "none"
          }
        },
        {
          text: "Date added to unit",
          attributes: {
            "aria-sort": "ascending"
          }
        },
        {
          text: "Expected to leave unit",
          attributes: {
            "aria-sort": "none"
          }
        },
        {
          text: ""
        },
        {
          text: ""
        }
      ],
      rows: rows,
      attributes: { "data-qa": "reverse-cohorting-table" }
    }) }}
  {% else %}
    <p class="govuk-body" data-qa="no-results-message">There are no results.</p>
  {% endif %}
{% endblock %}

{% block bodyEnd %}
{{ super() }}
<script src="/assets/moj/components/sortable-table/sortable-table.js"></script>
<script>
new MOJFrontend.SortableTable({
  table: $('table')[0],
})
</script>
{% endblock %}