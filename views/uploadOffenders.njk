{% extends "./partials/layout.njk" %}
{% from "govuk/components/error-summary/macro.njk" import govukErrorSummary %}
{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{% from "govuk/components/file-upload/macro.njk" import govukFileUpload %}
{% from "govuk/components/inset-text/macro.njk" import govukInsetText %}
{% from "govuk/components/back-link/macro.njk" import govukBackLink %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/input/macro.njk" import govukInput %}

{% set title = 'Upload a CSV File' %}

{% block beforeContent %}
  {{ govukBackLink({
    text: "Back",
    href: "/bulk-appointments/add-appointment-details"
  }) }}
{% endblock %}

{% block content %}
  {% if errors and errors.length > 0 %}
    {{ govukErrorSummary({
        titleText: "There is a problem",
        errorList: errors,
        attributes: { 'data-qa-errors': true }
      }) 
    }}
  {% endif %}

  <div class="govuk-width-container">
      <h1 class="govuk-heading-xl">{{title}}</h1>
      <p class="govuk-body">
        Upload a CSV file with the prisoner numbers of all prisoners attending this appointment: 
      </p>

      <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">

   <dl class="govuk-summary-list">
        <div class="govuk-summary-list__row">
          <dt class="govuk-summary-list__key">
            Appointment type
          </dt>
          <dd class="govuk-summary-list__value">
            {{appointmentDetails.appointmentTypeDescription}}
          </dd>
        </div>
        <div class="govuk-summary-list__row">
          <dt class="govuk-summary-list__key">
            Location
          </dt>
          <dd class="govuk-summary-list__value">
            {{appointmentDetails.locationDescription}}
          </dd>
        </div>

        <div class="govuk-summary-list__row">
          <dt class="govuk-summary-list__key">
            Start date
          </dt>
          <dd class="govuk-summary-list__value">
            {{appointmentDetails.date | getDate()}}
          </dd>
        </div>

        {% if appointmentDetails.startTime %}
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Time
            </dt>
            <dd class="govuk-summary-list__value">
              {{appointmentDetails.startTime | getTime()}}
              {% if appointmentDetails.endTime %}
                {{' to ' + appointmentDetails.endTime | getTime()}}
              {% endif %}
            </dd>
          </div>
        {% endif %}

        {% if appointmentDetails.endTime %}
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              End date
            </dt>
            <dd class="govuk-summary-list__value">
              {{appointmentDetails.endTime | getDate()}}
            </dd>
          </div>
        {% endif %}


      {% if appointmentDetails.recurring === 'yes' %}
        <div class="govuk-summary-list__row">
          <dt class="govuk-summary-list__key">
            Recurring
          </dt>
          <dd class="govuk-summary-list__value">
            {{ appointmentDetails.repeats }} , {{appointmentDetails.times}} Occurrences
            <div>
                {{ appointmentDetails.endOfPeriod }}
            </div>
          </dd>
        </div>
      {% endif %}
  </dl>

      {{ govukInsetText({
        text: "You can only include each prison number once on a CSV file. If you need to add appointments for different times for the same prisoner, you must do this using different CSV files."
      }) }}
      
      <form action="/bulk-appointments/upload-file" method="POST" enctype="multipart/form-data">

        {{ govukFileUpload({
          id: "file",
          name: "file",
          type: "file",
          errorMessage: errors | findError('file')
        }) }}

        {% for key, detail in data %}
          <input type="hidden" value="{{detail}}" name="{{key}}" />
        {% endfor %}

      <p class="govuk-body">
        <a href="/bulk-appointments/csv-template" class="govuk-!-font-size-19 govuk-link govuk-link--no-visited-state">Download a CSV file template</a>
      </p>

      {{ govukButton({
          text: "Continue",
          classes: "govuk-!-margin-right-1",
          preventDoubleClick: true
        }) }}

        {{ govukButton({
          text: "Cancel",
          classes: "govuk-button--secondary",
          element: 'a',
          href: '/bulk-appointments/add-appointment-details'
        }) }}
      </form>
  </div>
{% endblock %}
