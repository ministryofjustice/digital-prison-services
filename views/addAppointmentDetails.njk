{% from "govuk/components/fieldset/macro.njk" import govukFieldset %}
{% from "govuk/components/radios/macro.njk" import govukRadios %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/error-summary/macro.njk" import govukErrorSummary %}
{% from "govuk/components/select/macro.njk" import govukSelect %}
{% from "govuk/components/textarea/macro.njk" import govukTextarea %}
{% from "govuk/components/back-link/macro.njk" import govukBackLink %}
{% from "components/datePicker/datePicker.njk" import datePicker %}
{% from "components/timePicker/timePicker.njk" import timePicker %}

{% extends "./partials/layout.njk" %}

{% block beforeContent %}
    {{ govukBackLink({
        text: "Back",
        href: "/bulk-appointments/need-to-upload-file"
    }) }}
{% endblock %}

{%  set times %}
    {{ timePicker({
        id: 'start-time',
        label: 'Start time',
        name: 'startTime',
        hour: startTimeHours,
        minute: startTimeMinutes,
        errorMessage: errors | findError('start-time-hours')
    }) }}

    {{ timePicker({
        id: 'end-time',
        label: 'End time (optional)',
        name: 'endTime',
        hour: endTimeHours,
        minute: endTimeMinutes,
        errorMessage: errors | findError('end-time-hours')
    }) }}

{%  endset -%}

{% block content %}
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-one-third">

                {% if errors.length > 0 %}
                    {{ govukErrorSummary({
                        titleText: "There is a problem",
                        errorList: errors,
                        attributes: { 'data-qa-errors': true }
                    }) }}
                {% endif %}

                <form action="/bulk-appointments/add-appointment-details" method="POST">
                    {% call govukFieldset({
                        legend: {
                            text: title,
                            classes: "govuk-fieldset__legend--l",
                            isPageHeading: true
                        }
                    }) %}

                    {{ govukSelect({
                        id: "appointment-type",
                        name: "appointmentType",
                        label: {
                            text: "Appointment type"
                        },
                        items: appointmentTypes | addDefaultSelectedVale('Select') | setSelected(appointmentType),
                        errorMessage: errors | findError('appointment-type')
                    }) }}

                    {{ govukSelect({
                        id: "location",
                        name: "location",
                        label: {
                            text: "Location"
                        },
                        items: locations | addDefaultSelectedVale('Select') | setSelected(location),
                        errorMessage: errors | findError('location')
                    }) }}

                    {{ datePicker({
                        id: 'date',
                        label: 'Date',
                        name: 'date',
                        date: date,
                        errorMessage: errors | findError('date'),
                        attributes: {'data-disable-past-date':'true'}
                    }) }}

                    {{ govukRadios({
                        classes: "govuk-radios--inline",
                        idPrefix: "same-time-appointments",
                        name: "sameTimeAppointments",
                        errorMessage: errors | findError('same-time-appointments'),
                        fieldset: {
                            legend: {
                                text: "Do the appointments all have the same time?",
                                classes: "govuk-fieldset__legend--s"
                            }
                        },
                        items: [{
                                value: "yes",
                                text: "Yes",
                                checked: sameTimeAppointments == 'yes',
                                conditional: {
                                    html: times
                                }
                            },
                            {
                                value: "no",
                                text: "No",
                                checked: sameTimeAppointments == 'no'
                            }
                        ]
                    }) }}


                    {{ govukTextarea({
                        name: "comments",
                        id: "comments",
                        value: comments,
                        errorMessage: errors | findError('comments'),
                        label: {
                            text: "Comments (optional)"
                        }
                    }) }}

                    {% endcall %}

                    {{ govukButton({ text: "Continue" }) }}

                    {{ govukButton({
                        text: "Cancel",
                        element: 'a',
                        href: homeUrl,
                        classes: "govuk-button--secondary"
                    }) }}

                </form>
        </div>
    </div>
{% endblock %}
