{% extends "../partials/layout.njk" %}
{% from "govuk/components/error-summary/macro.njk" import govukErrorSummary %}
{% from "govuk/components/select/macro.njk" import govukSelect %}
{% from "govuk/components/input/macro.njk" import govukInput %}
{% from "govuk/components/textarea/macro.njk" import govukTextarea %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/date-input/macro.njk" import govukDateInput %}
{% from "govuk/components/input/macro.njk" import govukInput %}
{% from "govuk/components/fieldset/macro.njk" import govukFieldset %}
{% from "components/datePicker/datePicker.njk" import datePicker %}
{% from "components/timePicker/timePicker.njk" import timePicker %}

{% set title = 'Request new video link booking' %}

{% macro errorClass(field) -%}
  {{ ' govuk-input--error' if errors | hasErrorWithPrefix([field, 'dobError']) else '' }}
{%- endmacro %}

{% block beforeContent %}
    {{ govukBreadcrumbs({
        items: [
            {
                text: "Home",
                href: homeUrl
            },
            {
                text: title
            }
        ]
    }) }}
{% endblock %}

{% block content %}
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
            <h1 class="govuk-heading-l">
                {{title}}
            </h1>

            {% if errors.length > 0 %}
                {{ govukErrorSummary({
                    titleText: "There is a problem",
                    errorList: errors,
                    attributes: { 'data-qa-errors': true }
                }) }}
            {% endif %}

            <form method="POST" novalidate="novalidate">

                {{ govukInput({
                    label: {
                        text: "First name"
                    },
                    id: "first-name",
                    name: "firstName",
                    value: formValues.firstName,
                    classes: "govuk-!-width-one-third",
                    errorMessage: errors | findError('first-name')
                }) }}

                {{ govukInput({
                    label: {
                        text: "Last name"
                    },
                    id: "last-name",
                    name: "lastName",
                    value: formValues.lastName,
                    classes: "govuk-!-width-one-third",
                    errorMessage: errors | findError('last-name')
                }) }}

                {{ govukDateInput({
                    id: "dob",
                    fieldset: {
                        legend: {
                        text: "Date of birth",
                        classes: "govuk-fieldset__legend--s"
                        }
                    },
                    errorMessage: errors | findErrors(['dobDay', 'dobMonth', 'dobYear']),
                    hint: {
                        text: "For example, 12 11 1990"
                    },
                    items: [
                        {
                        id: "dobDay",
                        name: "dobDay",
                        label: "Day",
                        classes: "govuk-input--width-2" + errorClass('dobDay'),
                        value: formValues.dobDay
                        },
                        {
                        id: "dobMonth",
                        name: "dobMonth",
                        label: "Month",
                        classes: "govuk-input--width-2" + errorClass('dobMonth'),
                        value: formValues.dobMonth
                        },
                        {
                        id: "dobYear",
                        name: "dobYear",
                        label: "Year",
                        classes: "govuk-input--width-4" + errorClass('dobYear'),
                        value: formValues.dobYear
                        }
                    ]
                }) }}

                {{ govukSelect({
                    id: "prison",
                    name: "prison",
                    label: {
                        text: "Prison"
                    },
                    classes: 'js-prison',
                    items: [
                        {
                            value: "dominic.bull@digital.justice.gov.uk",
                            text: "HMP Wandsworth"
                        }
                    ],
                    errorMessage: errors | findError('prison')
                }) }}

                {{ govukInput({
                    label: {
                        text: "Court (hearing) location"
                    },
                    id: "hearing-location",
                    name: "hearingLocation",
                    value: formValues.hearingLocation,
                    classes: "govuk-!-width-one-third",
                    errorMessage: errors | findError('hearing-location')
                }) }}

                {{ govukInput({
                    label: {
                        text: "Case number"
                    },
                    id: "case-number",
                    name: "caseNumber",
                    value: formValues.caseNumber,
                    classes: "govuk-!-width-one-third",
                    errorMessage: errors | findError('case-number')
                }) }}

                {{ datePicker({
                    id: 'date',
                    label: 'Date',
                    name: 'date',
                    date: formValues.date,
                    errorMessage: errors | findError('date'),
                    attributes: {'data-disable-past-date':'true', 'data-add-appointment-date': 'true'}
                }) }}

                {{ timePicker({
                    id: 'start-time',
                    label: 'Start time',
                    name: 'startTime',
                    hour: formValues.startTimeHours,
                    minute: formValues.startTimeMinutes,
                    errorMessage: errors | findError('start-time-hours')
                }) }}

                {{ timePicker({
                    id: 'end-time',
                    label: 'End time',
                    name: 'endTime',
                    hour: formValues.endTimeHours,
                    minute: formValues.endTimeMinutes,
                    errorMessage: errors | findError('end-time-hours')
                }) }}

                {{ govukTextarea({
                    name: "comments",
                    id: "comments",
                    value: formValues.comments,
                    errorMessage: errors | findError('comments'),
                    classes: 'govuk-!-width-one-half',
                    label: {
                        text: "Comments (optional)"
                    },
                    hint: {
                        text: "Type of hearing and additional information"
                    }
                }) }}

                {{ govukButton({ text: "Continue", type: "submit" }) }}

                {{ govukButton({
                    text: "Cancel",
                    element: 'a',
                    href: homeUrl,
                    classes: "govuk-button--secondary"
                }) }}
            </form>
        </div>
    </div>
{% endblock %}
