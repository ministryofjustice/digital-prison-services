{% extends "./partials/layout.njk" %}

{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/inset-text/macro.njk" import govukInsetText %}
{% from "components/datePicker/datePicker.njk" import datePicker %}
{% from "govuk/components/error-summary/macro.njk" import govukErrorSummary %}

{% if shouldClearFormValues  %}
   {%  set period = null %}
   {%  set fromDate = null %}
   {%  set toDate = null %}
{%  endif %}

{% block beforeContent %}
  {{ govukBreadcrumbs({
  items: [
    {
      text: "Home",
      href: notmUrl
    },
    {
      text: "Manage prisoner whereabouts",
      href: "/manage-prisoner-whereabouts"
    },
    {
      text: "Attendance reason statistics"
    }
  ]
})
}}
{% endblock %}

{% block content %}

  <h1 class="govuk-heading-l govuk-!-margin-bottom-1">Attendance reason statistics</h1>
  <p class="govuk-body-l govuk-!-font-size-24">{{displayDate}} - {{displayPeriod}} </p>

  {% if errors.length > 0 %}
    {{ govukErrorSummary({
      titleText: "There is a problem",
      errorList: errors,
      attributes: { 'data-qa-errors': true }
    }) }}
  {% endif %}

  <form action="/manage-prisoner-whereabouts/attendance-reason-statistics">
    <div class="govuk-grid-row">
      <input type="hidden" name="agencyId" value="{{caseLoadId}}"/>
      <div class="govuk-grid-column-one-quarter">
        {{ datePicker({
            id: 'fromDate',
            label: 'Date',
            name: 'fromDate',
            date: fromDate,
            errorMessage: errors | findError('fromDate'),
            attributes: {'data-disable-future-date':'true'},
            errorMessage: errors | findError('fromDate')
        }) }}
      </div>

      <div class="govuk-grid-column-one-quarter">
        <div class="govuk-form-group">
          <label class="govuk-label" for="period">
            Period
          </label>

          <select class="govuk-select govuk-!-width-full" id="period" name="period" value={{ periodToSet }}>
            <option hidden selected>
             Select
            </option>
            <option value="AM" {% if period === "AM" %} selected {%endif%}>
              AM
            </option>
            <option value="PM" {% if period === "PM" %} selected {%endif%}>
              PM
            </option>
            <option value="ED" {% if period === "ED" %} selected {%endif%}>
              ED
            </option>
            <option value="AM_PM" {% if period === "AM_PM" %} selected {%endif%}>
              AM + PM
            </option>
          </select>
        </div>
      </div>
      <div class="govuk-grid-column-one-quarter">
        {{
          govukButton({
            type: submit,
            text: 'Update results',
            classes: 'govuk-button govuk-!-margin-top-6'
          })
        }}
      </div>
    </div>
  </form>

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-one-quarter">
          <a href="{{ statsForCurrentWeek }}" class="govuk-link govuk-!-font-size-19">View current week</a>
    </div>

    <div class="govuk-grid-column-one-quarter">
        <a href="{{ statsForPreviousWeek  }}" class="govuk-link govuk-!-font-size-19">View last week</a>
    </div>

    <div class="govuk-grid-column-one-quarter">
        <a href="{{ statsFor2WeeksAgo  }}" class="govuk-link govuk-!-font-size-19">View last 2 weeks</a>
    </div>
  </div>

  <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">

  {%if not isFuturePeriod %}
    <h2 class="govuk-heading-m">Not recorded</h2>

    <div class="govuk-grid-row">
      <div class="govuk-grid-column-one-quarter">
        <p class="govuk-body">Unaccounted for</p>
        <span class="govuk-body govuk-!-font-size-48 govuk-!-font-weight-bold">{{dashboardStats.notRecorded}}</span>
      </div>
    </div>
    <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">
    <h2 class="govuk-heading-m">Paid reasons</h2>

    <div class="govuk-grid-row ">

    <div class="govuk-grid-column-one-quarter">
      <p class="govuk-body">Attended</p>
      <span class="govuk-body govuk-!-font-size-48 govuk-!-font-weight-bold">{{dashboardStats.attended}}</span>
    </div>

     {% for paidReasons in dashboardStats.paidReasons | sort(attribute = "name") %}
        <div class="govuk-grid-column-one-quarter govuk-!-padding-bottom-3">
          <p class="govuk-body">{{paidReasons.name}}</p>
          <span class="govuk-body govuk-!-font-size-48 govuk-!-font-weight-bold">
            {% if paidReasons.value > 0 %}
              <a href="/manage-prisoner-whereabouts/attendance-reason-statistics/reason/{{paidReasons.id}}?agencyId={{caseLoadId}}&fromDate={{clickThrough.fromDate}}&toDate={{clickThrough.toDate}}&period={{clickThrough.period}}" class="govuk-link--no-visited-state">
                {{paidReasons.value}}
              </a>
            {% else %}
              {{paidReasons.value}}
            {% endif %}
          </span>
        </div>
      {% endfor %}
    </div>

    <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">
    <h2 class="govuk-heading-m">Not paid reasons</h2>

    <div class="govuk-grid-row">
      {% for unpaidReasons in dashboardStats.unpaidReasons | sort(attribute = "name") %}
        <div class="govuk-grid-column-one-quarter govuk-!-padding-bottom-3">
          <p class="govuk-body">{{unpaidReasons.name}}</p>
          <span class="govuk-body govuk-!-font-size-48 govuk-!-font-weight-bold">
            {% if unpaidReasons.value > 0 %}
              <a href="/manage-prisoner-whereabouts/attendance-reason-statistics/reason/{{unpaidReasons.id}}?agencyId={{caseLoadId}}&fromDate={{clickThrough.fromDate}}&toDate={{clickThrough.toDate}}&period={{clickThrough.period}}" class="govuk-link--no-visited-state">
                {{unpaidReasons.value}}
              </a>
            {% else %}
              {{unpaidReasons.value}}
            {% endif %}
          </span>
        </div>
      {% endfor %}
    </div>
    {%endif%}

    <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">
{% endblock %}
